<!DOCTYPE html>
<html>
<head>
    <title>Translate Test</title>
    <meta charset="utf-8">
</head>
<body>
    <table id="table_1">
        <tr id="table 1 row 1" draggable="true"><td>11</td><td>12</td></tr>
        <tr id="table 1 row 2" draggable="true"><td>21</td><td>22</td></tr>
    </table>
    <script>
    function addScaleButton(table){
    try{
        let ScaleButton = document.createElement("input");
        ScaleButton.type = "number";
        ScaleButton.classList.add("scaleButton");
        ScaleButton.id = "scale_button_id";
        let first_row = table.querySelector("tr");
        if(first_row === undefined){
            throw new Error("The table is empty");
        }
       first_row.appendChild(ScaleButton); // Buttons is given a parent so it can be attached to the left
       //attachToParent(ScaleButton, false); // Design specifies that buttons should be added on left side 
    }
    catch(error){
        console.error(error);
    }
    
}
    function moveButton(event){
    let target_row = event.currentTarget;
    let scaleButton = document.getElementById("scale_button_id");
    scaleButton.value = "1";
    target_row.appendChild(scaleButton);
    //attachToParent(ScaleButton, false);
    }

    table = document.getElementById("table_1");
    addScaleButton(table);
    rows  = document.querySelectorAll("tr"); 
    rows.forEach(element => {element.addEventListener("mouseover", moveButton)});
    </script>
    <script>
    function attachToParent(element, left){
    //get bounding rectangles for the element and its parent and initialise x and y
    //we begin by assuming that the element's parent is its frame of reference, so x and y begin as 0
    element.style.position = "absolute";

    const parent = element.parentElement;
    const childRect = element.getBoundingClientRect();
    const parentRect = parent.getBoundingClientRect();
    let x = 0, y = 0;

    //offset x to the right or left of the parent element
    if(left){
        x -= childRect.width;
        console.log(`Offsetting element to the left by ${childRect.width}`)
    } else {
        x += parentRect.width;
        console.log(`Offsetting element to the right by ${parentRect.width}`)
    }
    console.log(`x-offset coordinates are (${x}, ${y})`);

    //offset the y-coordinate so the two elements line up in the middle instead of at the top
    let a = parentRect.height, b = childRect.height;
    const offsetY = (a - b)/2;
    y += offsetY;
    console.log(`Y is offset by ${offsetY}px.`);
    console.log(`y-offset coordinates are (${x}, ${y})`);

    //now we have calculated the x- and y-values we need to offset the child with to place it right or left of its parent
    //but so far we have assumed that the parent is the child's frame of reference, i.e. that the parent is non-static.
    //this might not be the case, so now we find the closest non-static ancestor to the child and get its bounding rectangle
    let ancestor = parent;
    //while the parent of ancestor is not NULL and ancestor's position type is static, move ancestor up the DOM tree
    while (ancestor.parentElement && getComputedStyle(ancestor).position === "static") {
        ancestor = ancestor.parentElement;
    }
    const ancestorRect = ancestor.getBoundingClientRect();
    console.log(`Ancestor is ${ancestor}`)

    //offset x and y by the difference between the parent's coordinates and the ancestor's coordinates
    //note that if we wanted the x's and y's of something with respect to the body, instead of the difference between two things, we would need to offset it by the window.scrollX and window.scrollY respectively 
    //we choose to reuse a and b for ease of reading
    a = parentRect.left;
    b = ancestorRect.left;
    x += (a - b);
    console.log(`Difference between ancestor and parent x is ${a - b}`);

    a = parentRect.top;
    b = ancestorRect.top;
    y += (a - b);
    console.log(`Difference between ancestor and parent y is ${a - b}`);
    console.log(`Corrected coordinates are (${x}, ${y})`);

    //set the element's position
    element.style.left = `${x}px`;
    element.style.top = `${y}px`;
    console.log(`Final coordinates are (${x}, ${y})`);
}
    </script>
</body>